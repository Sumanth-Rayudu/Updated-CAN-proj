#include <SoftwareSerial.h>
#include <SPI.h>
#include <mcp2515.h>

SoftwareSerial bt(4, 5); // RX,Tx

struct can_frame canMsg;

MCP2515 mcp2515(10);      // SPI CS Pin 10

void setup()
{
  Serial.begin(9600);
  SPI.begin();
  bt.begin(9600);
  
  mcp2515.reset();
  mcp2515.setBitrate(CAN_500KBPS, MCP_8MHZ);
  mcp2515.setNormalMode();
}

void loop()
{
  if (mcp2515.readMessage(&canMsg) == MCP2515::ERROR_OK) {

      int hum = canMsg.data[0];
      int temp = canMsg.data[1];
      bool fire = canMsg.data[2];
      bool gas = canMsg.data[3];
      bool light = canMsg.data[4];

      // Perform actions based on received data
      Serial.print("Received Data - Humidity: ");
      Serial.print(hum);
      Serial.print("%, Temperature: ");
      Serial.print(temp);
      Serial.print("Â°C, IR Detected: ");
      Serial.print(fire ? "Yes" : "No");
      Serial.print(", Gas Detected: ");
      Serial.print(gas ? "Yes" : "No");
      Serial.print(", Light Detected: ");
      Serial.println(light ? "Yes" : "No");

      bt.print(temp);
      bt.print(";");
      bt.print(hum);
      bt.print(";");
       bt.print(gas);
      bt.print(";");
       bt.print(fire);
      bt.print(";");
       bt.print(light);
      bt.print(";");

      delay(1000);
   // }
  }
}
